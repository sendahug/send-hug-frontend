<div *ngIf="authService.canUser('read:admin-board')" id="adminDashAll">
	<nav id="breadcrumb" aria-label="Breadcrumb">
		<a [routerLink]="['/admin']" class="breadcrumb bLink">Admin Panel</a> <span *ngIf="screen != 'main'" class="breadcrumb">/ <a [routerLink]="['/admin/' + screen]" class="breadcrumb bLink">{{ screen }}</a></span>
	</nav>
	
	<!-- Admin dashboard navigation menu -->
	<nav id="adminNav" role="navigation">
		<a [routerLink]="['/admin']" class="adminNavItem" aria-label="navigate to admin dashboard main page">Main</a>
		<a [routerLink]="['/admin', 'reports']" class="adminNavItem" aria-label="navigate to admin dashboard reports page">Reports</a>
		<a [routerLink]="['/admin', 'blocks']" class="adminNavItem" aria-label="navigate to admin dashboard blocks page">Blocks</a>
		<a [routerLink]="['/admin', 'filters']" class="adminNavItem" aria-label="navigate to admin dashboard filters page">Filters</a>
	</nav>

	<!-- Admin dashboard main page -->
	<h3 class="adminTitle" *ngIf="screen == 'main'">Admin Dashboard</h3>
	<div class="adminScreen" id="adminMain" *ngIf="screen == 'main'" role="document">
		
		<div class="adminText">Welcome to the admin dashboard!</div>
		<div class="adminText">The admin dashboard is comprised of three parts:</div>
		<ul id="adminCategories">
			<li class="adminCategory" *ngFor="let category of adminCategories">
				<span class="pageCategory">{{ category.title }}:</span> <span class="pageText">{{ category.explanation }}</span>
			</li>
		</ul>
	</div>
	
	<div *ngIf="(screen == 'blocks' && !adminService.isBlocksResolved.value) || (screen == 'filters' && !adminService.isFiltersResolved.value)" id="loaderDiv">
		<app-loader
		[waitingFor]="waitFor"></app-loader>
	</div>

	<!-- Admin dashboard reports -->
	<app-admin-reports *ngIf="screen == 'reports'"></app-admin-reports>

	<!-- Admin dashboard blocks -->
	<h3 class="adminTitle" *ngIf="screen == 'blocks' && adminService.isBlocksResolved.value">Blocks</h3>
	<div class="adminScreen" id="adminBlocks" *ngIf="screen == 'blocks' && adminService.isBlocksResolved.value" role="main">
		
		<h4 class="subTitle">Block User</h4>
		<!-- Block a user by ID -->
		<form>
			<div class="formElement">
				<label class="pageCategory required" for="blockID">User I.D.: </label>
				<input type="text" id="blockID" placeholder="user I.D." #blockID required  minlength="0" aria-invalid="false" aria-required="true">
			</div>
			<div class="formElement">
				<label class="pageCategory" for="blockLength">Length of block time: </label>
				<select id="blockLength" name="blockLength" #blockLength required>
					<option value="oneDay">One Day</option>
					<option value="oneWeek">One Week</option>
					<option value="oneMonth">30 Days</option>
					<option value="forever">Permanently</option>
				</select>
			</div>
			<button type="submit" class="appButton sendData" (click)="block($event,blockID.value, blockLength.value)">Block User</button>
		</form>
		
		<h4 class="subTitle">Blocked Users</h4>
		<!-- Blocked users table -->
		<div class="tableContainer" *ngIf="adminService.blockedUsers.length">
			<table>
				<thead>
					<tr>
						<td scope="col">User I.D.</td>
						<td scope="col">Display Name</td>
						<td scope="col">Blocked Until</td>
						<td scope="col">Action</td>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let user of adminService.blockedUsers">
						<td aria-describedby="bUserID">{{ user.id }}</td>
						<td aria-describedby="bUserDisplay" id="{{ 'user' + user.id }}">{{ user.displayName }}</td>
						<td [attr.aria-describedby]="'user' + user.id + ' bUntil'">{{ user.releaseDate }}</td>
						<td>
							<span id="{{ 'unblock' + user.id }}" class="labels">{{ 'unblock user ' + user.displayName }}</span>
							<button class="appButton adminButton" (click)="unblock(user.id)" [attr.aria-labelledby]="'unblock' + user.id">Unblock User</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<!-- Blocked users pagination -->
		<div class="pagination" *ngIf="adminService.blockedUsers.length" role="navigation">
			<button
				[class]="adminService.currentPage.blockedUsers > 1 ? previousButtonClass : previousButtonClass + ' disabled'"
				[disabled]="adminService.currentPage.blockedUsers <= 1"
				(click)="prevPage('blockedUsers')"
				aria-label="previous page of blocked users"
			>Previous Page</button>
			<div class="pageCount">Page {{ adminService.currentPage.blockedUsers }} of {{ adminService.totalPages.blockedUsers }}</div>
			<button 
				[class]="adminService.totalPages.blockedUsers > adminService.currentPage.blockedUsers ? nextButtonClass : nextButtonClass + ' disabled'"
				[disabled]="adminService.totalPages.blockedUsers <= adminService.currentPage.blockedUsers"
				(click)="nextPage('blockedUsers')"
				aria-label="next page of blocked users"
			>Next Page</button>
		</div>
		
		<!-- If there are no blocked users -->
		<div *ngIf="!adminService.blockedUsers.length" class="errorMessage">There are no blocked users.</div>
	</div>

	<!-- Admin dashboard filters -->
	<h3 class="adminTitle" *ngIf="screen == 'filters' && adminService.isFiltersResolved.value">Filters</h3>
	<div class="adminScreen" id="adminFilters" *ngIf="screen == 'filters' && adminService.isFiltersResolved.value" role="main">
		
		<h4 class="subTitle">Add Filter</h4>
		<!-- Add a word/phrase to filtered words list -->
		<form>
			<div class="formElement">
				<label class="pageCategory required" for="filter">Filter: </label>
				<input type="text" id="filter" placeholder="Filter" #filter required  minlength="0" aria-invalid="false" aria-required="true">
			</div>
			<button type="submit" class="appButton sendData" (click)="addFilter($event,filter.value)">Add Filter</button>
		</form>
		
		<h4 class="subTitle">Filtered Phrases</h4>
		<!-- Filtered phrases table -->
		<div class="tableContainer" *ngIf="adminService.filteredPhrases.length">
			<table>
				<thead>
					<tr>
						<td scope="col">Phrase</td>
						<td scope="col">Action</td>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let phrase of adminService.filteredPhrases">
						<td aria-describedby="filteredP" id="{{ phrase.filter }}">{{ phrase.filter }}</td>
						<td>
							<span id= "{{ 'f_' + phrase.id }}" class="labels">{{ 'Remove filter ' + filter.filter }}</span>
							<button class="appButton adminButton" (click)="removeFilter(phrase.id)" [attr.aria-labelledby]="'f_' + phrase.id">Remove Filter</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<!-- Filtered words pagination -->
		<div class="pagination" *ngIf="adminService.filteredPhrases.length" role="navigation">
			<button
				[class]="adminService.currentPage.filteredPhrases > 1 ? previousButtonClass : previousButtonClass + ' disabled'"
				[disabled]="adminService.currentPage.filteredPhrases <= 1"
				(click)="prevPage('filteredPhrases')"
				aria-label="previous page of filtered phrases"
			>Previous Page</button>
			<div class="pageCount">Page {{ adminService.currentPage.filteredPhrases }} of {{ adminService.totalPages.filteredPhrases }}</div>
			<button
				[class]="adminService.totalPages.filteredPhrases > adminService.currentPage.filteredPhrases ? nextButtonClass : nextButtonClass + ' disabled'"
				[disabled]="adminService.totalPages.filteredPhrases <= adminService.currentPage.filteredPhrases"
				(click)="nextPage('filteredPhrases')"
				aria-label="next page of filtered phrases"
			>Next Page</button>
		</div>
		
		<!-- If there are no filtered phrases -->
		<div *ngIf="!adminService.filteredPhrases.length" class="errorMessage">There are no filtered phrases.</div>
	</div>
	
	<!-- Labels for screen readers -->
		<div id="labels" class="labels" aria-hidden="true">
			<p id="rUserID">Reported user's I.D</p>
			<p id="rUserDisplay">Reported user's display name</p>
			<p id="rUserBy">Reported by</p>
			<p id="rUserFor">Reported for</p>
			<p id="pPostID">Reported post's I.D</p>
			<p id="pUserID">Reported post's user I.D</p>
			<p id="pText">Reported post's text</p>
			<p id="pUserBy">Reported by</p>
			<p id="pUserFor">Reported for</p>
			<p id="bUserID">Blocked user's I.D</p>
			<p id="bUserDisplay">Blocked user's display name</p>
			<p id="bUntil">Blocked until</p>
			<p id="filteredP">Filtered phrase</p>
		</div>
</div>

<div *ngIf="!authService.canUser('read:admin-board')">
	<div class="errorMessage">You do not have permission to view thie page!</div>
	<a [routerLink]="" class="appButton">Back to homepage</a>
</div>

<app-pop-up *ngIf="editMode"
			[editedItem]="toEdit"
			[toEdit]="editType"
			(editMode)="changeMode($event)"
			[delete]="delete"
			[toDelete]="toDelete"
			[itemToDelete]="itemToDelete"
			[report]="report"
			[reportData]="reportData"></app-pop-up>