<h3>Mail</h3>
<!-- If the user is logged in, displays the user's inbox. -->
<div id="userInbox" *ngIf="authService.authenticated">
	<!-- Messages area navigation. -->
	<div id="messagesNav">
		<button class="messNavOption appButton" (click)="changeMailbox('inbox')">Inbox</button>
		<button class="messNavOption appButton" (click)="changeMailbox('outbox')">Outbox</button>
		<button class="messNavOption appButton" (click)="changeMailbox('threads')">Threads</button>
	</div>
	
	<app-loader
		[waitingFor]="waitFor"></app-loader>

	<!-- If there are messages in the user's inbox -->
	<div *ngIf="(messType == 'inbox' || messType == 'outbox') && itemsService.userMessages[messType].length">
		<div *ngFor="let message of itemsService.userMessages[messType]" class="userMessage">
			<div class="messageField" *ngIf="messType == 'inbox'">
				<span class="pageCategory">From:</span> <span class="pageData">{{ message.from }}</span>
			</div>
			<div class="messageField" *ngIf="messType == 'outbox'">
				<span class="pageCategory">For:</span> <span class="pageData">{{ message.for }}</span>
			</div>
			<div class="pageCategory">Message:</div> <div class="pageData">{{ message.messageText }}</div>
			<div class="buttons">
				<a [routerLink]="['/new', 'Message']" [queryParams]="{user: message.from, userID: message.fromId}" class="appButton messageButton">Reply</a>
				<button class="appButton deleteButton" (click)="deleteMessage(message.id)">Delete</button>
			</div>
		</div>
	</div>
	
		<!-- If the user is looking at threads -->
	<div *ngIf="messType == 'threads'">
		<ul class="userThreads" *ngIf="itemsService.userMessages.threads.length">
			<li class="userThread" *ngFor="let thread of itemsService.userMessages.threads">
				<div class="messageField">
					<span class="pageCategory">User:</span> <span class="pageData">{{ thread.user }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Messages:</span> <span class="pageData">{{ thread.numMessages }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Last Active:</span> <span class="pageData">{{ thread.latestMessage }}</span>
				</div>
				<div class="threadBtns">
					<button class="appButton viewButton" (click)="loadThread(thread.id)">View Messages</button>
					<button class="appButton deleteButton" (click)="deleteThread(thread.id)">Delete</button>
				</div>
			</li>
		</ul>
		<button class="appButton deleteButton" (click)="deleteAllMessages('threads')">Delete All Threads</button>
	</div>
	
	<!-- Message pagination -->
	<div class="pagination" *ngIf="itemsService.userMessages[messType].length">
		<button *ngIf="itemsService.userMessagesPage[messType] > 1" class="appButton prevButton" (click)="prevPage()">Previous Page</button>
		<button *ngIf="itemsService.userMessagesPage[messType] <= 1" class="appButton hidden" (click)="prevPage()">Previous Page</button>
		<div class="pageCount">Page {{ itemsService.userMessagesPage[messType] }} of {{ itemsService.totalUserMessagesPages[messType] }}</div>
		<button *ngIf="itemsService.totalUserMessagesPages[messType] > itemsService.userMessagesPage[messType]" class="appButton nextButton" (click)="nextPage()">Next Page</button>
		<button *ngIf="itemsService.totalUserMessagesPages[messType] <= itemsService.userMessagesPage[messType]" class="appButton hidden" (click)="nextPage()">Next Page</button>
	</div>
	<button class="appButton deleteButton" (click)="deleteAllMessages(messType)" *ngIf="itemsService.userMessages[messType].length && (messType == 'inbox' || messType == 'outbox')">Delete All Messages</button>

	<!-- If there are no messages in the user's outbox -->
	<div *ngIf="!itemsService.userMessages[messType].length && itemsService.isUserMessagesResolved[messType].value">
		<div class="errorMessage">You have no messages in this mailbox.</div>
	</div>
	
	<!-- If the user is looking a specific thread -->
	<div *ngIf="messType == 'thread'">
		<ul class="threadMessages">
			<li class="userMessage" *ngFor="let message of itemsService.threadMessages">
				<div class="messageField">
					<span class="pageCategory">From:</span> <span class="pageData">{{ message.from }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">For:</span> <span class="pageData">{{ message.for }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Text:</span> <span class="pageData">{{ message.messageText }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Date:</span> <span class="pageData">{{ message.date }}</span>
				</div>
				<div class="threadBtns">
					<a [routerLink]="['/new', 'Message']" [queryParams]="{user: message.from, userID: message.fromId}" class="appButton messageButton">Reply</a>
					<button class="appButton deleteButton" (click)="deleteMessage(message.id)">Delete</button>
				</div>
			</li>
		</ul>
	</div>
</div>

<!-- If the user isn't logged in, prompts the user to log in. -->
<div id="loginBox" *ngIf="!authService.authenticated">
	<div class="errorMessage">You are not currently logged in. To view your inbox, log in.</div>

	<button id="logIn" class="appButton" (click)="login()">Login</button>
</div>

<app-pop-up *ngIf="editMode"
			[editedItem]="postToEdit"
			[toEdit]="editType"
			(editMode)="changeMode($event)"
			[delete]="delete"
			[toDelete]="toDelete"
			[itemToDelete]="itemToDelete"
			[messType]="messType"></app-pop-up>