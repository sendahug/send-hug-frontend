<div id="mailboxNav">
	<h3>{{ messType }}</h3>
<!-- Messages area navigation. -->
	<div id="messagesNav" role="navigation" *ngIf="authService.authenticated">
		<button class="messNavOption appButton" (click)="changeMailbox('inbox')">Inbox</button>
		<button class="messNavOption appButton" (click)="changeMailbox('outbox')">Outbox</button>
		<button class="messNavOption appButton" (click)="changeMailbox('threads')">Threads</button>
	</div>
</div>

<!-- If the user is logged in, displays the user's inbox. -->
<div id="userInbox" *ngIf="authService.authenticated">
	<app-loader
		[waitingFor]="waitFor"></app-loader>
	
	<app-header-message
		[waitingFor]="waitFor"></app-header-message>

	<!-- If there are messages in the user's inbox -->
	<ul *ngIf="(messType == 'inbox' || messType == 'outbox') && itemsService.userMessages[messType].length" class="mailboxMessages" aria-describedby="messType">
		<li *ngFor="let message of itemsService.userMessages[messType]" class="userMessage"  aria-describedby="messType">
			<div class="messageField" *ngIf="messType == 'inbox'">
				<span class="pageCategory">From:</span> <span class="pageData" aria-describedby="mUserFrom">{{ message.from }}</span>
			</div>
			<div class="messageField" *ngIf="messType == 'outbox'">
				<span class="pageCategory">For:</span> <span class="pageData" aria-describedby="mUserFor">{{ message.for }}</span>
			</div>
			<div class="pageCategory">Message:</div> <div class="pageData" aria-describedby="mText" id="{{'text' + message.id}}">{{ message.messageText }}</div>
			<div class="buttons">
				<a [routerLink]="['/new', 'Message']" [queryParams]="{user: message.from, userID: message.fromId}" class="appButton messageButton" [attr.aria-describedby]="'mReply ' +  'text' + message.id" *ngIf="messType == 'inbox'">Reply</a>
				<button class="appButton deleteButton" (click)="deleteMessage(message.id)" [attr.aria-describedby]="'mDelete ' + text + message.id">Delete</button>
			</div>
		</li>
	</ul>
	
		<!-- If the user is looking at threads -->
	<div *ngIf="messType == 'threads'">
		<ul class="userThreads" *ngIf="itemsService.userMessages.threads.length" aria-describedby="messType">
			<li class="userThread" *ngFor="let thread of itemsService.userMessages.threads" aria-describedby="messType">
				<div class="messageField">
					<span class="pageCategory">User:</span> <span class="pageData" aria-describedby="tUser" id="{{ 'user' + thread.id }}">{{ thread.user }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Messages:</span> <span class="pageData" [attr.aria-describedby]="'tNumMess ' + 'user' + thread.id">{{ thread.numMessages }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Last Active:</span> <span class="pageData" [attr.aria-describedby]="'tLatestMess ' + 'user' + thread.id">{{ thread.latestMessage }}</span>
				</div>
				<div class="threadBtns">
					<button class="appButton viewButton" (click)="loadThread(thread.id)" [attr.aria-describedby]="'tView ' + 'user' + thread.id">View Messages</button>
					<button class="appButton deleteButton" (click)="deleteThread(thread.id)" [attr.aria-describedby]="'tDelete ' + 'user' + thread.id">Delete</button>
				</div>
			</li>
		</ul>
	</div>
	
	<!-- Message pagination -->
	<div class="pagination" *ngIf="itemsService.userMessages[messType].length" role="navigation">
		<button *ngIf="itemsService.userMessagesPage[messType] > 1" class="appButton prevButton" (click)="prevPage()">Previous Page</button>
		<button *ngIf="itemsService.userMessagesPage[messType] <= 1" class="appButton placeHolder">Previous Page</button>
		<div class="pageCount">Page {{ itemsService.userMessagesPage[messType] }} of {{ itemsService.totalUserMessagesPages[messType] }}</div>
		<button *ngIf="itemsService.totalUserMessagesPages[messType] > itemsService.userMessagesPage[messType]" class="appButton nextButton" (click)="nextPage()">Next Page</button>
		<button *ngIf="itemsService.totalUserMessagesPages[messType] <= itemsService.userMessagesPage[messType]" class="appButton placeHolder">Previous Page</button>
	</div>
	<button class="appButton deleteButton deleteAll" (click)="deleteAllMessages(messType)" *ngIf="itemsService.userMessages[messType].length && (messType == 'inbox' || messType == 'outbox')">Delete All Messages</button>
	<button *ngIf="messType == 'threads' && itemsService.userMessages.threads.length" class="appButton deleteButton deleteAll" (click)="deleteAllMessages('threads')">Delete All Threads</button>

	<!-- If there are no messages in the user's outbox -->
	<div *ngIf="!itemsService.userMessages[messType].length && itemsService.isUserMessagesResolved[messType].value">
		<div class="errorMessage">You have no messages in this mailbox.</div>
	</div>
	
	<!-- If the user is looking a specific thread -->
	<div *ngIf="messType == 'thread'">
		<ul class="threadMessages" aria-describedby="messType">
			<li class="userMessage" *ngFor="let message of itemsService.threadMessages" aria-describedby="messType">
				<div class="messageField">
					<span class="pageCategory">From:</span> <span class="pageData" aria-describedby="mUserFrom">{{ message.from }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">For:</span> <span class="pageData" aria-describedby="mUserFor">{{ message.for }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Text:</span> <span class="pageData" aria-describedby="mText" id="{{ 'mText' + message.id }}">{{ message.messageText }}</span>
				</div>
				<div class="messageField">
					<span class="pageCategory">Date:</span> <span class="pageData" aria-describedby="mDate">{{ message.date }}</span>
				</div>
				<div class="threadBtns">
					<a [routerLink]="['/new', 'Message']" [queryParams]="{user: message.from, userID: message.fromId}" class="appButton messageButton" [attr.aria-describedby]="'mReply ' + 'mText' + message.id">Reply</a>
					<button class="appButton deleteButton" (click)="deleteMessage(message.id)" [attr.aria-describedby]="'mDelete ' + 'mText' + message.id">Delete</button>
				</div>
			</li>
		</ul>
	</div>
</div>

<!-- If the user isn't logged in, prompts the user to log in. -->
<div id="loginBox" *ngIf="!authService.authenticated">
	<div class="errorMessage">You are not currently logged in. To view your inbox, log in.</div>

	<button id="logIn" class="appButton" (click)="login()">Login</button>
</div>

<div id="labels" class="labels" aria-hidden="true">
	<p id="mText">Message text</p>
	<p id="mUserFrom">Message from</p>
	<p id="mUserFor">Message for</p>
	<p id="mDate">Message sent at</p>
	<p id="mReply">Reply to message</p>
	<p id="mDelete">Delete message</p>
	<p id="tUser">Message thread with</p>
	<p id="tNumMess">Number of messages in thread with</p>
	<p id="tLatestMess">Latest message in thread with</p>
	<p id="tView">View thread with</p>
	<p id="tDelete">Delete thread with</p>
</div>

<app-pop-up *ngIf="editMode"
			[editedItem]="postToEdit"
			[toEdit]="editType"
			(editMode)="changeMode($event)"
			[delete]="delete"
			[toDelete]="toDelete"
			[itemToDelete]="itemToDelete"
			[messType]="messType"></app-pop-up>